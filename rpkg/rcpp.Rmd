---
title: "Calling C++ with Rcpp"
author: "Michael Love"
date: 10/25/2018
output: html_document
---

# Hello world example

Install Rcpp

```
Imports: Rcpp (>= 0.11.0)
LinkingTo: Rcpp
```

<http://www.rcpp.org/>

<http://dirk.eddelbuettel.com/code/rcpp.html>

<http://dirk.eddelbuettel.com/code/rcpp.armadillo.html>

`load_all`

`compileAttributes`, build and install

```
#include <Rcpp.h>
using namespace Rcpp;

// [[Rcpp::export]]
List rcpp_hello_world() {
  CharacterVector x = CharacterVector::create( "foo", "bar" ) ;
  NumericVector y = NumericVector::create( 0.0, 1.0 ) ;
  List z = List::create( x, y ) ;
  return z ;
}
```

show what happened

`Rcpp_0.12.19`

`R/RcppExports.R`

```{r eval=FALSE}
# Generated by using Rcpp::compileAttributes() -> do not edit by hand
# Generator token: 10BE3573-1514-4C36-9D1C-5A225CD40393

rcpp_hello_world <- function() {
    .Call('_foo_rcpp_hello_world', PACKAGE = 'foo')
}
```

`src/RcppExports.cpp`

```
// Generated by using Rcpp::compileAttributes() -> do not edit by hand
// Generator token: 10BE3573-1514-4C36-9D1C-5A225CD40393

#include <Rcpp.h>

using namespace Rcpp;

// rcpp_hello_world
List rcpp_hello_world();
RcppExport SEXP _foo_rcpp_hello_world() {
BEGIN_RCPP
    Rcpp::RObject rcpp_result_gen;
    Rcpp::RNGScope rcpp_rngScope_gen;
    rcpp_result_gen = Rcpp::wrap(rcpp_hello_world());
    return rcpp_result_gen;
END_RCPP
}

static const R_CallMethodDef CallEntries[] = {
    {"_foo_rcpp_hello_world", (DL_FUNC) &_foo_rcpp_hello_world, 0},
    {NULL, NULL, 0}
};

RcppExport void R_init_foo(DllInfo *dll) {
    R_registerRoutines(dll, NULL, CallEntries, NULL, NULL);
    R_useDynamicSymbols(dll, FALSE);
}
```

```{r eval=FALSE}
#' @useDynLib foo
#' @export
rcpp.hello.world <- function() {
  rcpp_hello_world()
}
```

`document` and `load_all`

```{r eval=FALSE}
rcpp.hello.world()
```

# An example that returns an Rcpp type

```
// [[Rcpp::export]]
NumericVector add_one_sqrt(NumericVector x) {
  NumericVector y(x);
  y = sqrt(x + 1.0);
  return y;
}
```

```{r eval=FALSE}
#' @export
add.one.sqrt <- function(x) {
  add_one_sqrt(x)
}
```

```{r eval=FALSE}
add.one.sqrt(1:10)
```

# RcppArmadillo example

```
#include <RcppArmadillo.h>
using namespace Rcpp;

// [[Rcpp::export]]
arma::mat matrix_mult(const arma::mat& X, const arma::mat& Y) {
  int m = X.n_rows;
  int n = Y.n_cols;
  arma::mat Z(m,n);
  Z = X * Y;
  return Z;
}
```

We need to add this to the DESCRIPTION:

```
Imports: Rcpp (>= 0.11.0), RcppArmadillo
LinkingTo: Rcpp, RcppArmadillo
```

```{r eval=FALSE}
#' @export
matrix.mult <- function(X,Y) {
  matrix_mult(X,Y)
}
```

document and load_all

```{r eval=FALSE}
matrix.mult(matrix(1:12,ncol=4), matrix(13:24,nrow=4))
```

